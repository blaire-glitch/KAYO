{% extends "base.html" %}

{% block title %}Dashboard - KAYO | ACK Diocese of Nambale{% endblock %}

{% block extra_css %}
<style>
    /* Role-Based Theme Colors */
    :root {
        --super-admin-gold: #FFD700;
        --super-admin-bg: #1a1a2e;
        --super-admin-glow: rgba(255, 215, 0, 0.4);
        
        --admin-green: #1a5f2a;
        --admin-gold: #D4AF37;
        
        --youth-minister-sage: #4ADE80;
        --youth-minister-bg: #ECFDF5;
        
        --chair-yellow: #FBBF24;
        --chair-green: #22C55E;
        
        --finance-green: #059669;
        --finance-gold: #EAB308;
        
        --reg-officer-green: #1a5f2a;
        --reg-officer-purple: #7C3AED;
        
        --data-clerk-green: #1a5f2a;
        --data-clerk-teal: #0D9488;
        
        --viewer-gray: #6B7280;
    }
    
    /* Welcome Card Base */
    .welcome-card {
        border-radius: 16px;
        padding: 24px;
        margin-bottom: 24px;
        position: relative;
        overflow: hidden;
    }
    
    .welcome-card .role-badge {
        display: inline-block;
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    
    .welcome-card h2 {
        margin: 12px 0 8px;
        font-weight: 700;
    }
    
    .welcome-card .access-level {
        font-size: 0.9rem;
        opacity: 0.9;
    }
    
    /* Super Admin - Premium Gold Theme */
    .welcome-card.super-admin {
        background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #1a1a2e 100%);
        color: white;
        border: 2px solid var(--super-admin-gold);
        box-shadow: 0 0 30px var(--super-admin-glow), inset 0 0 60px rgba(255, 215, 0, 0.05);
        animation: superAdminGlow 3s ease-in-out infinite;
    }
    
    @keyframes superAdminGlow {
        0%, 100% { box-shadow: 0 0 30px var(--super-admin-glow), inset 0 0 60px rgba(255, 215, 0, 0.05); }
        50% { box-shadow: 0 0 50px var(--super-admin-glow), inset 0 0 80px rgba(255, 215, 0, 0.1); }
    }
    
    .welcome-card.super-admin .role-badge {
        background: linear-gradient(135deg, var(--super-admin-gold), #FFA500);
        color: #1a1a2e;
    }
    
    .welcome-card.super-admin h2 {
        background: linear-gradient(90deg, var(--super-admin-gold), #FFA500);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }
    
    .welcome-card.super-admin::before {
        content: '‚ö°';
        position: absolute;
        right: 20px;
        top: 20px;
        font-size: 3rem;
        opacity: 0.3;
    }
    
    /* Admin - Green with Gold */
    .welcome-card.admin {
        background: linear-gradient(135deg, var(--admin-green) 0%, #0d4a1c 100%);
        color: white;
        border-left: 4px solid var(--admin-gold);
    }
    
    .welcome-card.admin .role-badge {
        background: var(--admin-gold);
        color: #1a1a2e;
    }
    
    .welcome-card.admin::before {
        content: 'üõ°Ô∏è';
        position: absolute;
        right: 20px;
        top: 20px;
        font-size: 2.5rem;
        opacity: 0.3;
    }
    
    /* Chair - Yellow to Green */
    .welcome-card.chair {
        background: linear-gradient(135deg, #FEF3C7 0%, #D9F99D 100%);
        color: #15803D;
        border-left: 4px solid var(--chair-yellow);
    }
    
    .welcome-card.chair .role-badge {
        background: linear-gradient(135deg, var(--chair-yellow), var(--chair-green));
        color: white;
    }
    
    .welcome-card.chair::before {
        content: '‚òÄÔ∏è';
        position: absolute;
        right: 20px;
        top: 20px;
        font-size: 2.5rem;
        opacity: 0.4;
    }
    
    /* Finance - Green with Gold Glow */
    .welcome-card.finance {
        background: linear-gradient(135deg, #065F46 0%, #047857 100%);
        color: white;
        border-left: 4px solid var(--finance-gold);
        animation: financeGlow 2s ease-in-out infinite;
    }
    
    @keyframes financeGlow {
        0%, 100% { box-shadow: 0 4px 20px rgba(234, 179, 8, 0.2); }
        50% { box-shadow: 0 4px 30px rgba(234, 179, 8, 0.4); }
    }
    
    .welcome-card.finance .role-badge {
        background: var(--finance-gold);
        color: #1a1a2e;
    }
    
    .welcome-card.finance::before {
        content: 'üí∞';
        position: absolute;
        right: 20px;
        top: 20px;
        font-size: 2.5rem;
        opacity: 0.4;
    }
    
    /* Registration Officer - Green with Purple */
    .welcome-card.registration-officer {
        background: linear-gradient(135deg, var(--reg-officer-green) 0%, #166534 100%);
        color: white;
        border-left: 4px solid var(--reg-officer-purple);
    }
    
    .welcome-card.registration-officer .role-badge {
        background: var(--reg-officer-purple);
        color: white;
    }
    
    .welcome-card.registration-officer::before {
        content: 'üìã';
        position: absolute;
        right: 20px;
        top: 20px;
        font-size: 2.5rem;
        opacity: 0.3;
    }
    
    /* Data Clerk - Green with Teal */
    .welcome-card.data-clerk {
        background: linear-gradient(135deg, #134E4A 0%, #0F766E 100%);
        color: white;
        border-left: 4px solid var(--data-clerk-teal);
    }
    
    .welcome-card.data-clerk .role-badge {
        background: var(--data-clerk-teal);
        color: white;
    }
    
    .welcome-card.data-clerk::before {
        content: 'üìä';
        position: absolute;
        right: 20px;
        top: 20px;
        font-size: 2.5rem;
        opacity: 0.3;
    }
    
    /* Viewer - Neutral Gray */
    .welcome-card.viewer {
        background: linear-gradient(135deg, #F3F4F6 0%, #E5E7EB 100%);
        color: #374151;
        border-left: 4px solid var(--viewer-gray);
    }
    
    .welcome-card.viewer .role-badge {
        background: var(--viewer-gray);
        color: white;
    }
    
    .welcome-card.viewer::before {
        content: 'üëÅÔ∏è';
        position: absolute;
        right: 20px;
        top: 20px;
        font-size: 2.5rem;
        opacity: 0.3;
    }
    
    /* DYO - Diocesan Youth Officer - Royal Purple & Gold Executive Theme */
    .welcome-card.dyo {
        background: linear-gradient(135deg, #1e1b4b 0%, #312e81 50%, #1e1b4b 100%);
        color: white;
        border: 3px solid #a855f7;
        box-shadow: 0 0 40px rgba(168, 85, 247, 0.5), inset 0 0 80px rgba(168, 85, 247, 0.1);
        animation: dyoGlow 3s ease-in-out infinite;
    }
    
    @keyframes dyoGlow {
        0%, 100% { box-shadow: 0 0 40px rgba(168, 85, 247, 0.5), inset 0 0 80px rgba(168, 85, 247, 0.1); }
        50% { box-shadow: 0 0 60px rgba(168, 85, 247, 0.7), inset 0 0 100px rgba(168, 85, 247, 0.2); }
    }
    
    .welcome-card.dyo h2 {
        background: linear-gradient(90deg, #c084fc, #f472b6, #facc15);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        font-size: 1.8rem;
    }
    
    .welcome-card.dyo .role-badge {
        background: linear-gradient(135deg, #a855f7, #ec4899);
        color: white;
        font-weight: 700;
        padding: 6px 16px;
        font-size: 0.85rem;
        box-shadow: 0 4px 15px rgba(168, 85, 247, 0.4);
    }
    
    .welcome-card.dyo .access-level {
        color: #e9d5ff;
        font-weight: 500;
    }
    
    .welcome-card.dyo::before {
        content: 'üëë';
        position: absolute;
        right: 20px;
        top: 20px;
        font-size: 3.5rem;
        opacity: 0.5;
        animation: crownFloat 2s ease-in-out infinite;
    }
    
    @keyframes crownFloat {
        0%, 100% { transform: translateY(0) rotate(-5deg); }
        50% { transform: translateY(-5px) rotate(5deg); }
    }
    
    .welcome-card.dyo::after {
        content: '‚ú®';
        position: absolute;
        right: 70px;
        top: 30px;
        font-size: 1.5rem;
        opacity: 0.6;
        animation: sparkle 1.5s ease-in-out infinite;
    }
    
    @keyframes sparkle {
        0%, 100% { opacity: 0.3; transform: scale(0.8); }
        50% { opacity: 0.8; transform: scale(1.2); }
    }

    /* Default User */
    .welcome-card.user {
        background: linear-gradient(135deg, var(--admin-green) 0%, #2d8f42 100%);
        color: white;
        border-left: 4px solid #22C55E;
    }
    
    .welcome-card.user .role-badge {
        background: #22C55E;
        color: white;
    }
    
    .welcome-card.user::before {
        content: 'üë§';
        position: absolute;
        right: 20px;
        top: 20px;
        font-size: 2.5rem;
        opacity: 0.3;
    }
</style>
{% endblock %}

{% block content %}
<!-- Role-Based Welcome Card -->
{% set role_class = current_user.role | replace('_', '-') %}
{% if current_user.role == 'viewer' %}
    {% set role_class = 'dyo' %}
{% endif %}
<div class="welcome-card {{ role_class }}">
    {% if current_user.role == 'viewer' %}
    <span class="role-badge">üëë Diocesan Youth Officer</span>
    {% endif %}
    <h2>Welcome back, {{ current_user.name }}!</h2>
    <p class="access-level mb-0">
        {% if current_user.role == 'chair' %}
            {% if current_user.parish %}Parish: {{ current_user.parish }}{% endif %}
            {% if current_user.local_church %} ‚Ä¢ {{ current_user.local_church }}{% endif %}
        {% elif current_user.role == 'viewer' %}
            Overseer ‚Ä¢ KAYO Diocese of Nambale
        {% else %}
            KAYO - ACK Diocese of Nambale
        {% endif %}
    </p>
</div>

<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h4 class="mb-0"><i class="bi bi-speedometer2 me-2"></i>Dashboard</h4>
    </div>
    {% if current_user.role != 'viewer' %}
    <a href="{{ url_for('delegates.register_delegate') }}" class="btn btn-primary">
        <i class="bi bi-person-plus me-2"></i>Register Delegate
    </a>
    {% endif %}
</div>

<!-- Stats Cards -->
<div class="row mb-4">
    <div class="col-md-4 mb-3">
        <div class="card stat-card">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <div class="stat-value">{{ total_delegates }}</div>
                    <div class="stat-label">Total Delegates</div>
                </div>
                <div class="stat-icon text-primary">
                    <i class="bi bi-people"></i>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-4 mb-3">
        <div class="card stat-card">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <div class="stat-value text-success">{{ paid_delegates }}</div>
                    <div class="stat-label">Paid Delegates</div>
                </div>
                <div class="stat-icon text-success">
                    <i class="bi bi-check-circle"></i>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-4 mb-3">
        <div class="card stat-card">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <div class="stat-value text-danger">{{ unpaid_delegates }}</div>
                    <div class="stat-label">Unpaid Delegates</div>
                </div>
                <div class="stat-icon text-danger">
                    <i class="bi bi-exclamation-circle"></i>
                </div>
            </div>
        </div>
    </div>
</div>

{% if unpaid_delegates > 0 and current_user.role != 'viewer' %}
<div class="alert alert-warning d-flex align-items-center" role="alert">
    <i class="bi bi-exclamation-triangle-fill me-3" style="font-size: 1.5rem;"></i>
    <div>
        <strong>Payment Required!</strong> You have {{ unpaid_delegates }} unpaid delegate(s). 
        Total: <strong>KSh {{ unpaid_delegates * 1000 | int }}</strong>
        <a href="{{ url_for('payments.payment_page') }}" class="btn btn-warning btn-sm ms-3">Pay Now</a>
    </div>
</div>
{% endif %}

<div class="row">
    <!-- Recent Delegates -->
    <div class="col-lg-8 mb-4">
        <div class="card">
            <div class="card-header bg-white d-flex justify-content-between align-items-center">
                <h5 class="mb-0"><i class="bi bi-people me-2"></i>Recent Delegates</h5>
                <a href="{{ url_for('delegates.list_delegates') }}" class="btn btn-sm btn-outline-primary">View All</a>
            </div>
            <div class="card-body">
                {% if delegates %}
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Parish</th>
                                <th>Gender</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for delegate in delegates[:5] %}
                            <tr>
                                <td>{{ delegate.name }}</td>
                                <td>{{ delegate.parish }}</td>
                                <td>{{ delegate.gender | capitalize }}</td>
                                <td>
                                    {% if delegate.is_paid %}
                                    <span class="badge badge-paid">Paid</span>
                                    {% else %}
                                    <span class="badge badge-unpaid">Unpaid</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <a href="{{ url_for('delegates.view_delegate', id=delegate.id) }}" class="btn btn-sm btn-outline-secondary">
                                        <i class="bi bi-eye"></i>
                                    </a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="text-center py-5">
                    <i class="bi bi-person-plus text-muted" style="font-size: 3rem;"></i>
                    <p class="mt-3 text-muted">No delegates registered yet.</p>
                    {% if current_user.role != 'viewer' %}
                    <a href="{{ url_for('delegates.register_delegate') }}" class="btn btn-primary">Register First Delegate</a>
                    {% endif %}
                </div>
                {% endif %}
            </div>
        </div>
    </div>
    
    <!-- Recent Payments -->
    <div class="col-lg-4 mb-4">
        <div class="card">
            <div class="card-header bg-white">
                <h5 class="mb-0"><i class="bi bi-credit-card me-2"></i>Recent Payments</h5>
            </div>
            <div class="card-body">
                {% if payments %}
                <ul class="list-group list-group-flush">
                    {% for payment in payments %}
                    <li class="list-group-item d-flex justify-content-between align-items-center px-0">
                        <div>
                            <strong>KSh {{ payment.amount | int }}</strong>
                            <br>
                            <small class="text-muted">{{ payment.created_at.strftime('%d %b %Y') }}</small>
                        </div>
                        <span class="badge bg-{{ 'success' if payment.status == 'completed' else 'warning' if payment.status == 'pending' else 'danger' }}">
                            {{ payment.status | capitalize }}
                        </span>
                    </li>
                    {% endfor %}
                </ul>
                <div class="mt-3">
                    <a href="{{ url_for('payments.payment_history') }}" class="btn btn-sm btn-outline-primary w-100">View All Payments</a>
                </div>
                {% else %}
                <p class="text-muted text-center py-3">No payments yet.</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}
